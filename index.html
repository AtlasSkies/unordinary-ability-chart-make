<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UnOrdinary Power Chart Maker</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      font-family: Candara, sans-serif;
      background: #f0f8fc;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 20px 40px;
      margin: 0;
      color: #333;
    }

    .header-with-info {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
      position: relative;
    }

    .title-block { 
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      text-align: center;
      font-style: italic;
      color: #333;
      margin: 0;
    }

    .subtitle { 
      font-style: italic;
      font-size: 14px;
      color: #666; 
      margin-top: -5px; 
    }

    .info-container {
      position: relative;
      display: inline-block;
      margin-left: 8px;
      cursor: pointer;
    }

    .info-icon {
      display: inline-block;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background-color: #6db5c0;
      color: white;
      text-align: center;
      line-height: 18px;
      font-weight: bold;
      font-size: 14px;
    }

    .info-hover {
      visibility: hidden;
      width: 300px;
      background-color: #333;
      color: #fff;
      text-align: left;
      border-radius: 6px;
      padding: 10px;
      position: absolute;
      z-index: 100;
      top: 115%; 
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .info-container:hover .info-hover {
      visibility: visible;
      opacity: 1;
    }

    .container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: flex-start;
      gap: 30px;
      max-width: 1200px;
      width: 100%;
    }

    .left {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      min-width: 300px;
    }

    .upload-img {
      width: clamp(180px, 25vw, 250px);
      height: clamp(180px, 25vw, 250px);
      border: 2px dashed #aaa;
      border-radius: 10px;
      object-fit: cover;
      background-color: white;
    }

    .info-box {
      background-color: white;
      color: black;
      border-radius: 8px;
      padding: 8px 12px;
      width: clamp(180px, 25vw, 250px);
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .info-box label {
      display: flex;
      justify-content: space-between;
      font-weight: bold;
      font-style: normal;
      font-size: 15px;
    }
    .info-box input {
      width: 100px;
      border-radius: 4px;
      border: 1px solid #ccc;
      padding: 3px;
      font-family: Candara;
    }

    .inputs {
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: center;
    }

    label {
      font-style: italic;
      color: #333;
      font-size: 15px;
      display: flex;
      justify-content: space-between;
      width: clamp(200px, 80%, 260px);
    }

    input[type="number"], input[type="text"] {
      width: 110px;
      border-radius: 4px;
      border: 1px solid #ccc;
      padding: 4px;
      font-family: Candara;
    }

    input[type="color"] {
      border: none;
      background: none;
      width: 60px;
      height: 40px;
      cursor: pointer;
    }

    button {
      margin-top: 8px;
      padding: 6px 12px;
      font-family: Candara;
      font-weight: bold;
      background-color: #92dfec;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    button:hover {
      background-color: #6db5c0;
      color: white;
    }

    .chart-area {
      position: relative;
      width: clamp(300px, 40vw, 500px); 
      height: clamp(300px, 40vw, 500px);
    }

    .overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10;
    }

    .hidden { display: none; }

    .character-box {
      background: #fff;
      width: 52vw;
      height: 64vh;
      border-radius: 15px;
      position: relative;
      color: #000;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 40px;
      overflow: hidden;
      padding: 20px;
    }

    .close-btn {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 28px;
      background: none;
      border: none;
      cursor: pointer;
    }

    .image-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }

    .overlay-img {
      width: 300px;
      height: 300px;
      object-fit: cover;
      border: 3px solid #493e3b;
      border-radius: 6px;
    }

    .text-box {
      position: absolute;
      bottom: -45px;
      width: 80%;
      background: white;
      border: 3px solid #493e3b;
      padding: 10px;
      font-family: Candara;
      text-align: center;
    }

    .overlay-chart {
      display: flex;
      justify-content: center;
      align-items: center;
      width: clamp(280px, 40vw, 450px); 
      height: clamp(280px, 40vw, 450px);
    }

    #downloadBtn {
      position: absolute;
      bottom: 10px;
      right: 10px;
      background: #92dfec;
      border: none;
      border-radius: 5px;
      padding: 6px 10px;
      cursor: pointer;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="left">
      <div class="header-with-info">
        <div class="title-block">
          <h1>UnOrdinary Power Chart Maker</h1>
          <div class="subtitle">By Atlas Skies</div>
        </div>
      </div>

      <input type="file" accept="image/*" id="imgInput">
      <img id="uploadedImg" class="upload-img" alt="Uploaded Image">

      <div class="info-box">
        <label><b>Name:</b> <input type="text" id="nameInput"></label>
        <label><b>Ability:</b> <input type="text" id="abilityInput"></label>
        <label><b>Level:</b> <input type="text" id="levelInput"></label>
      </div>

      <div class="inputs">
        <label>Power: <input type="number" id="powerInput" step="0.1" min="0"></label>
        <label>Speed: <input type="number" id="speedInput" step="0.1" min="0"></label>
        <label>Trick: <input type="number" id="trickInput" step="0.1" min="0"></label>
        <label>Recovery: <input type="number" id="recoveryInput" step="0.1" min="0"></label>
        <label>Defense: <input type="number" id="defenseInput" step="0.1" min="0"></label>
        <label>Ability Color: <input type="color" id="colorPicker" value="#92dfec"></label>

        <button id="viewBtn">View Character Chart</button>
      </div>
    </div>

    <div class="chart-area">
      <canvas id="radarChart1"></canvas>
    </div>
  </div>

  <!-- Overlay -->
  <div id="overlay" class="overlay hidden">
    <div id="characterBox" class="character-box">
      <button id="closeBtn" class="close-btn">Ã—</button>

      <div class="image-section">
        <img id="overlayImg" class="overlay-img" alt="Character Image">
        <div class="text-box">
          <b>Name:</b> <span id="overlayName">-</span><br>
          <b>Ability:</b> <span id="overlayAbility">-</span><br>
          <b>Level:</b> <span id="overlayLevel">-</span>
        </div>
      </div>

      <div class="overlay-chart">
        <canvas id="radarChart2"></canvas>
      </div>

      <button id="downloadBtn">Download Character Chart</button>
    </div>
  </div>

  <script>
    let radar1, radar2;
    let radar2Ready = false;
    let chartColor = '#92dfec';

    const CHART1_CENTER = { x: 247, y: 250 };
    const CHART_SCALE_FACTOR = 0.8;
    const CHART_SIZE_MULTIPLIER = 1.0;

    function hexToRGBA(hex, alpha) {
      const r = parseInt(hex.slice(1, 3), 16);
      const g = parseInt(hex.slice(3, 5), 16);
      const b = parseInt(hex.slice(5, 7), 16);
      return `rgba(${r},${g},${b},${alpha})`;
    }

    const fixedCenterPlugin = {
      id: 'fixedCenter',
      beforeLayout(chart) {
        const opt = chart.config.options.fixedCenter;
        if (!opt?.enabled) return;
        const r = chart.scales.r;
        if (opt.centerX && opt.centerY) {
          r.xCenter = opt.centerX;
          r.yCenter = opt.centerY;
        }
        r.drawingArea *= CHART_SCALE_FACTOR;
      }
    };

    const radarBackgroundPlugin = {
      id: 'customPentagonBackground',
      beforeDatasetsDraw(chart) {
        const opts = chart.config.options.customBackground;
        if (!opts?.enabled) return;
        const r = chart.scales.r, ctx = chart.ctx;
        const cx = r.xCenter, cy = r.yCenter, radius = r.drawingArea;
        const N = chart.data.labels.length, start = -Math.PI / 2;

        const gradient = ctx.createRadialGradient(cx, cy, 0, cx, cy, radius);
        gradient.addColorStop(0, '#f8fcff');
        gradient.addColorStop(0.33, '#92dfec');
        gradient.addColorStop(1, '#92dfec');

        ctx.save();
        ctx.beginPath();
        for (let i = 0; i < N; i++) {
          const a = start + (i * 2 * Math.PI / N);
          const x = cx + radius * Math.cos(a);
          const y = cy + radius * Math.sin(a);
          i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
        }
        ctx.closePath();
        ctx.fillStyle = gradient;
        ctx.fill();
        ctx.restore();
      },
      afterDatasetsDraw(chart) {
        const opts = chart.config.options.customBackground;
        if (!opts?.enabled) return;
        const r = chart.scales.r, ctx = chart.ctx;
        const cx = r.xCenter, cy = r.yCenter, radius = r.drawingArea;
        const N = chart.data.labels.length, start = -Math.PI / 2;

        ctx.save();
        ctx.beginPath();
        for (let i = 0; i < N; i++) {
          const a = start + (i * 2 * Math.PI / N);
          const x = cx + radius * Math.cos(a);
          const y = cy + radius * Math.sin(a);
          ctx.moveTo(cx, cy);
          ctx.lineTo(x, y);
        }
        ctx.strokeStyle = '#35727d';
        ctx.lineWidth = 1;
        ctx.stroke();

        ctx.beginPath();
        for (let i = 0; i < N; i++) {
          const a = start + (i * 2 * Math.PI / N);
          const x = cx + radius * Math.cos(a);
          const y = cy + radius * Math.sin(a);
          i === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
        }
        ctx.closePath();
        ctx.strokeStyle = '#184046';
        ctx.lineWidth = 3;
        ctx.stroke();
        ctx.restore();
      }
    };

    const outlinedLabelsPlugin = {
      id: 'outlinedLabels',
      afterDraw(chart) {
        const ctx = chart.ctx;
        const r = chart.scales.r;
        const labels = chart.data.labels;
        const cx = r.xCenter;
        const cy = r.yCenter;
        const baseRadius = r.drawingArea * 1.05 + 25;
        const base = -Math.PI / 2;

        ctx.save();
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.font = 'italic 18px Candara';
        ctx.strokeStyle = chartColor;
        ctx.fillStyle = 'white';
        ctx.lineWidth = 4;

        labels.forEach((label, i) => {
          let angle = base + (i * 2 * Math.PI / labels.length);
          if (label === 'Defense') angle -= 0.08;
          else if (label === 'Speed') angle += 0.05;
          const x = cx + baseRadius * Math.cos(angle);
          const y = cy + baseRadius * Math.sin(angle);
          ctx.strokeText(label, x, y);
          ctx.fillText(label, x, y);
        });
        ctx.restore();
      }
    };

    function makeRadar(ctx, showPoints = true, withBackground = false, fixedCenter = null) {
      return new Chart(ctx, {
        type: 'radar',
        data: {
          labels: ['Power', 'Speed', 'Trick', 'Recovery', 'Defense'],
          datasets: [{
            data: [0, 0, 0, 0, 0],
            backgroundColor: hexToRGBA(chartColor, 0.65),
            borderColor: chartColor,
            borderWidth: 2,
            pointBackgroundColor: '#fff',
            pointBorderColor: chartColor,
            pointRadius: showPoints ? 5 : 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          scales: {
            r: {
              grid: { display: false },
              angleLines: { color: '#6db5c0', lineWidth: 1 },
              suggestedMin: 0,
              suggestedMax: 10,
              ticks: { display: false },
              pointLabels: {
                display: true,
                font: { size: 16, style: 'italic', family: 'Candara' },
                color: chartColor
              }
            }
          },
          customBackground: { enabled: withBackground },
          fixedCenter: { enabled: !!fixedCenter, centerX: fixedCenter?.x, centerY: fixedCenter?.y },
          plugins: { legend: { display: false } }
        },
        plugins: [fixedCenterPlugin, radarBackgroundPlugin, outlinedLabelsPlugin]
      });
    }

    const viewBtn = document.getElementById('viewBtn');
    const imgInput = document.getElementById('imgInput');
    const uploadedImg = document.getElementById('uploadedImg');
    const overlay = document.getElementById('overlay');
    const overlayImg = document.getElementById('overlayImg');
    const overlayName = document.getElementById('overlayName');
    const overlayAbility = document.getElementById('overlayAbility');
    const overlayLevel = document.getElementById('overlayLevel');
    const closeBtn = document.getElementById('closeBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const powerInput = document.getElementById('powerInput');
    const speedInput = document.getElementById('speedInput');
    const trickInput = document.getElementById('trickInput');
    const recoveryInput = document.getElementById('recoveryInput');
    const defenseInput = document.getElementById('defenseInput');
    const colorPicker = document.getElementById('colorPicker');
    const nameInput = document.getElementById('nameInput');
    const abilityInput = document.getElementById('abilityInput');
    const levelInput = document.getElementById('levelInput');

    window.addEventListener('load', () => {
      const ctx1 = document.getElementById('radarChart1').getContext('2d');
      radar1 = makeRadar(ctx1, true, true, CHART1_CENTER);
      chartColor = colorPicker.value;
      updateCharts();
    });

    function updateCharts() {
      const vals = [
        +powerInput.value || 0,
        +speedInput.value || 0,
        +trickInput.value || 0,
        +recoveryInput.value || 0,
        +defenseInput.value || 0
      ];
      const capped = vals.map(v => Math.min(v, 10));
      chartColor = colorPicker.value;
      const fill = hexToRGBA(chartColor, 0.65);

      if (radar1) {
        radar1.data.datasets[0].data = vals;
        radar1.data.datasets[0].borderColor = chartColor;
        radar1.data.datasets[0].pointBorderColor = chartColor;
        radar1.data.datasets[0].backgroundColor = fill;
        radar1.options.scales.r.pointLabels.color = chartColor;
        radar1.update();
      }

      if (radar2Ready && radar2) {
        radar2.data.datasets[0].data = capped;
        radar2.data.datasets[0].borderColor = chartColor;
        radar2.data.datasets[0].backgroundColor = fill;
        radar2.options.scales.r.pointLabels.color = chartColor;
        radar2.update();
      }
    }

    [powerInput, speedInput, trickInput, recoveryInput, defenseInput, colorPicker]
      .forEach(el => {
        el.addEventListener('input', updateCharts);
        el.addEventListener('change', updateCharts);
      });

    imgInput.addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = ev => { uploadedImg.src = ev.target.result; };
      reader.readAsDataURL(file);
    });

    viewBtn.addEventListener('click', () => {
      overlay.classList.remove('hidden');
      overlayImg.src = uploadedImg.src;
      overlayName.textContent = nameInput.value || '-';
      overlayAbility.textContent = abilityInput.value || '-';
      overlayLevel.textContent = levelInput.value || '-';

      setTimeout(() => {
        const img = document.getElementById('overlayImg');
        const textBox = document.querySelector('.text-box');
        const overlayChart = document.querySelector('.overlay-chart');
        const imgHeight = img.offsetHeight;
        const textHeight = textBox.offsetHeight;
        const targetSize = (imgHeight + textHeight) * CHART_SIZE_MULTIPLIER;

        overlayChart.style.height = `${targetSize}px`;
        overlayChart.style.width = `${targetSize}px`;

        const ctx2 = document.getElementById('radarChart2').getContext('2d');
        if (!radar2Ready) {
          radar2 = makeRadar(ctx2, false, true, { x: targetSize / 2, y: targetSize / 2 });
          radar2Ready = true;
        } else {
          radar2.resize();
        }
        updateCharts();
      }, 200);
    });

    closeBtn.addEventListener('click', () => overlay.classList.add('hidden'));

    downloadBtn.addEventListener('click', () => {
      downloadBtn.style.visibility = 'hidden';
      closeBtn.style.visibility = 'hidden';
      html2canvas(document.getElementById('characterBox'), { scale: 2 }).then(canvas => {
        const link = document.createElement('a');
        link.download = (nameInput.value || 'UnOrdinary_Character') + '_chart.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
        downloadBtn.style.visibility = 'visible';
        closeBtn.style.visibility = 'visible';
      });
    });
  </script>
</body>
</html>
